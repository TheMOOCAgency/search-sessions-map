<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Courses Sessions</title>
    <!-- BOOTSTRAP-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- DATE PICKER -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />

    <!-- MOMENT JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/locale/fr.js"></script>

    <style>
      #banner{
        background-color:#4882FF;
      }
      #map {
        height: 50vh;
        width: 100%;
      }
      #mapWrapper{
        display: flex;
        align-items: center;
        justify-content: center;
      }
      html, body {
        height: 100%;
        margin: 0;
        padding: 0px;
      }
      #searchWrapper{
        padding:0px;
      }
      #datepicker{
        color: #EDF6EB;
        border: 1px solid #3562C5;
      }
      .searchButton{
        display: inline-flex;
        margin-left: -200px;
      }
      .searchButton > p{
        font-size: 12px;
        color: #EDF6EB;
        position: relative;
        left: -120px;
        top: 45px;
        text-decoration: underline;
        display: none;
      }
      .searchButton > button:hover{
        color:#2ED801!important;
        background-color: #EDF6EB;
      }
      .row{
        display: inline-flex;
        width: 90%;
      }
      p{
        margin:0;
      }
      .inputWrapper{
        display: flex;
        /* align-items: center; */
        justify-content: center;
        padding-left: 5px;
        padding-right: 5px;
      }
      .titleSearch{
        width: 400px;
        margin-left: 200px;
        margin-top: 50px;
        margin-bottom: 50px;
        font-weight: 900;
        font-size:2rem;
      }
      .hide{
        display: none;
      }
      .custom-select{
        margin: 0!important;
        border: 1px solid #3562C5;
      }
      .mainColor{
        color:#4983FF
      }
      .secondColor{
        color:#f7c30d;
      }
      .secondColorBg{
        background-color:#2ED801;
      }
      .filterIntro{
        font-weight: bold;
        display: inline-flex;
        color: #EDF6EB;
        margin-right: 20px;
      }
      .textBold{
        font-weight: bold;
      }
      button{
        border: 0;
        padding: 10px 20px;
        border-radius: 5px;
        transition: background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;
      }
      select, input{
        background-color: #3562C5!important;
        color: #EDF6EB!important;
        font-weight: 500!important;
      }
      #search, #register{
        color: #EDF6EB;
      }
      #searchCourses{
        padding: 20px 0px;
      }
      #resultsWrapper{
        padding: 20px;
      }
      #reinitializer:hover{
        color: #3562C5;
        cursor: pointer;
      }
      .card{
        background-color: #DDEEFF;
        margin: 10px 0px;
        padding:20px;
        flex-direction: row !important;
      }
      .card > *{
        margin-top: 20px;
        margin-bottom: 20px;
        margin-left: 10px;
        margin-right: 10px;
        width: 20%;
      }
      .card > img{
        width: 6%;
      }
      .card > h6, .card > #titleAndRegion{
        display: inline-block;
        /* width: 200px; */
      }
      .card > #subInfos > button{
        height: 50px;
        color:  #EDF6EB;
        border-radius: 0px;
      }
      .card > #subInfos > button:hover{
        color:#2ED801!important;
        background-color: #EDF6EB;
      }
      #titleAndRegion {
        color: #145b90;
      }
      #titleAndRegion > p {
        font-style: italic;
      }
      /* #trainingDetails{
        display: inline-block;
        width: 400px;
      } */
      .monthBar{
        background-color: #4882FF;
        color: #EDF6EB;
        height: 50px;
        padding-left: 75px;
        padding-top: 16px;
      }
      .monthBar > h4{
        font-size: 16px;
      }
      #subInfos{
        width: 40%;
      }
      #subInfos > *{
        display: inline-block;
      }
      #subInfos > img{
        margin-right: 20px;
      }
      #subInfos > h6{
        margin-right: 20px;
      }
      #markerAndTown{
        width: 14%;
        padding-top: 15px;
      }
      #markerAndTown > *{
        display: inline-block;
        font-size: 16px;
        font-weight: 400;
        color: #5E747D;
      }
      #resultsWrapper{
        width: 80%;
        margin: 0 auto;
      }
      #resultsWrapper > div{
        color: #145b90;
      }
      #resultsWrapper > div > h4{
        display: inline-block;
      }
      #markerLocationInfos{
        text-align: center;
      }
      #markerLocationInfos > img{
        position: relative;
        top: -5px;
      }
      #markerRegistration > button{
        color: #EDF6EB;
        background-color: #3562C5;
        border-radius: 0px;
        height: 20px;
        padding-top: 3px;
      }
      #markerRegistration > button:hover{
        color: #3562C5;
        background-color: #EDF6EB;
      }
      #markerFirstHeading{
        font-size: 14px;
        font-weight: 900;
        margin-bottom: 10px;
        text-align: center;
        color: #145b90;
      }
      #markerFirstHeading > span{
        font-weight: 400;
      }
      #markerBodyContent{
        color: #0a4e56;
        text-align: center;
      }
      #markerTrainingDates{
        display: inline-block;
        list-style-type: none;
        margin-bottom: 0px;
      }
      #markerTrainingDates > li{
        background-color: #EDF6EB;
        font-weight: 500;
        margin-bottom: 6px;
        height: 20px;
      }
      #markerRegistration{
        display: inline-block;
        vertical-align: top;
        margin-left: 10px;
        text-align: center;
      }
      #markerTown{
        display: inline-block;
        text-align: center;
        font-size: 16px;
        font-weight: 900;
        margin-bottom: 0px;
        color: #145b90;
      }
      #markerDetails{
        text-align: center;
        margin-top: 0px;
      }
    </style>
  </head>
  <body>
    <p class="titleSearch mainColor">Toutes les prochaines sessions en région</p>
    <div id="banner">
      <div id="searchWrapper" class="container">
        <div id="searchCourses">
            <p class="filterIntro mainColor">Filtrer par</p>
          <div class="row">

            <div class="col-md-3 inputWrapper hide" id="datePickerWrap">
              <div class="input-group flex-nowrap"><input type="text" id="datepicker" class="form-control mb-3" placeholder="Date" aria-label="organisme"></div>
            </div>
          </div>
          <div class="searchButton">
            <button id="search" class="secondColorBg mainColor textBold">Rechercher</button>
            <p id="reinitializer">Réinitialiser les filtres</p>
          </div>
        </div>
      </div>
    </div>
    <div id="mapWrapper">
      <div id="map"></div>
    </div>
    <div id="resultsWrapper" class="hide">
      <div>
        <h4 class="mainColor textBold">Résultats de recherche</h4><span id ="results"></span>
      </div>
    </div>

    <!-- BOOTSTRAP-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>


    <!-- DATE PICKER-->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
      $(document).ready(function() {
        $( "#datepicker" ).daterangepicker(
          {
            autoUpdateInput: true,
          }
        );
        document.getElementById('datepicker').value = '';
        $('#reinitializer')[0].style.display = 'none';
      } );
    </script>

    <!-- GOOGLE MAPS-->
    <script>

      // DATA
      var locations;
      var markerLocations;
      var saveMarkerLocations;
      var sessionsLocations;
      var getFieldValues;
      var fields;
      var urlForm = 'http://inveest.the-mooc-agency.com/register';
      var of;
      var ville;
      var date_debut;
      var date_fin;

      // Data Base loading, as a callback of googleapis. When DB is loaded, we show the map and the filters bar
      var startAPI = function () {
        var getLocations = new Promise(function(resolve, reject) {
          var requestURL = './json/locations.json';
          var request = new XMLHttpRequest();
          request.open('GET', requestURL);
          request.responseType = 'json';
          request.send();
          request.onload = function() {
            locations = request.response;
            resolve(setDatas());
          }
        });
      }

      // This is a callback of startAPI(), wich show the API with a fully loaded DB containing all locations
      var setDatas = function () {
        markerLocations = locations;

        saveMarkerLocations = JSON.parse(JSON.stringify(markerLocations));

        sessionsLocations = (function () {
          var buildASession = function (i, j) {
            var oneSession = JSON.parse(JSON.stringify(locations[i]));
            oneSession.sessions = locations[i].sessions[j];
            return oneSession
          };

          var sessions = [];
          for (var i = 0; i < locations.length; i++) {
            for (var j = 0; j < locations[i].sessions.length; j++) {
              sessions.push(buildASession(i, j));
            };
          }
          return sessions
        })();

        getFieldValues = function (field) {
          values = [];
          for (var i = 0; i < locations.length; i++) {
            var alreadyExist = false;
            for (var j = 0; j < values.length; j++) {
              if (values[j] === locations[i].sites.adresse[field] || values[j] === locations[i].of[field]) {
                alreadyExist = true;
              }
            }
            if (!alreadyExist) {
              if (field === 'nom') {
                values.push(locations[i].of[field]);
              } else {
                values.push(locations[i].sites.adresse[field]);
              }
            }
          }
          var fields = function (values) {
            fieldsList = [];
            for (var i = 0; i < values.length; i++) {
              fieldsList.push({label:values[i], name:values[i]})
            }
            return fieldsList
          }
          return fields(values);
        };

        fields=[
          {
            label:'Région',
            name:'region',
            values:getFieldValues('region'),
            type:'select'
          },
          {
            label:'Département',
            name:'departement',
            values:getFieldValues('departement'),
            type:'select'
          },
          {
            label:'Organisme',
            name:'nom',
            values:getFieldValues('nom'),
            type:'select'
          },
          {
            label:'Date',
            type:'dateRangePicker',
            name:'datepicker'
          },
        ];
        buildSearchBar(fields);
        $('#datepicker').val('');
        launchSearch();
      };
      

      // FUNCTIONS
      var launchSearch = function () {
        // First filtering, that generate one result (location) per session
        locations = filterData();
        displayResults(locations);
        // There is is a second filtering exclusively for markers, because we do not want a marker for each session, only one marker for each training (wich contains X sessions)
        markerLocations = filterMarkers();
        initMap();
      }

      var sortByAlphabet = function (list, property) {
        if (!list || !list[0]) {
          return false
        }
        if (property) {
          if (typeof property === 'string') {
            list.sort(function (a, b) {
              return a[property].localeCompare(b[property]);
            });
          } else if (typeof property === 'number') {
            list.sort(function (a, b) {
              return a[property] - b[property];
            });
          }
        } else {
          list.sort();
        }
      }

      function buildSearchBar(fields){
        fields.map(function(field){
          sortByAlphabet(field.values, 'name');
          if(field.type === 'select'){
            var fieldInput='<div class="col-md-2 inputWrapper"> <select class="custom-select mb-3" id="'+field.name+'"><option value="'+field.name+'">'+field.label+'</option>';
            field.values.map(function (value) {
              fieldInput+='<option value="'+value.name+'">'+value.label+'</option>'
            })  
            fieldInput+='</select>';
            $('#searchCourses .row').append(fieldInput);
          }
          else if(field.type==='dateRangePicker'){
          $('#datePickerWrap').removeClass('hide'); 
          }
        })
        var updateReinitializer = function () {
          if ($('#region')[0].value !== 'region' || $('#departement')[0].value !== 'departement' || $('#nom')[0].value !== 'nom' || $('#datepicker')[0].value !== ''){
            $('#reinitializer')[0].style.display = 'initial';
          } else {
            $('#reinitializer')[0].style.display = 'none';
          }
        }
        $('select').change(function () {
          updateReinitializer();
        })
        $('#datepicker').change(function () {
          updateReinitializer();
        })
        $('#reinitializer').click(function () {
          $('#region')[0].value = 'region';
          $('#departement')[0].value = 'departement';
          $('#nom')[0].value = 'nom';
          $('#datepicker')[0].value = '';
          $('#reinitializer')[0].style.display = 'none';
          launchSearch();
        })
      }
      
      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 5,
          center: {lat: 46.8534, lng: 2.3488}
        });

        // Create an array of alphabetical characters used to label the markers.
        var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

        // Add some markers to the map.
        // Note: The code uses the JavaScript Array.prototype.map() method to
        // create an array of markers based on a given "locations" array.
        // The map() method here has nothing to do with the Google Maps API.
        var markers = markerLocations.map(function(location, i) {
          return new google.maps.Marker({
            position: location.sites.position,
            map: map,
            label: {
              text: labels[i % labels.length],
              color: 'black',
              fontSize: '10px'
            },
            icon: {
              url: './icons/trainingIcon.svg', // url
              scaledSize: new google.maps.Size(30, 30), // scaled size
              origin: new google.maps.Point(0, 0), // origin
              anchor: new google.maps.Point(15, 30), // anchor
              labelOrigin: new google.maps.Point(15, 13), // label offset
            },
          });
        });

        // create popup on markers
        (function (){
          var markerSaved;
          // popup contents for markers
          var contentString = function (marker) {
            if (marker) {

              markerSaved = marker;

              // We create a liste with every sessions possible for the training
              var getDatesList = function (dates) {
                var list = '<ul id="markerTrainingDates">';
                for (var i = 0; i < dates.length; i++) {
                  list += '<li>Session du ' + dates[i].periode.debut + ' au ' + dates[i].periode.fin;
                  // PUT HERE SOME TEST TO CHECK IF REGISTRATION DATE STILL OK /!\
                  if (true) {
                    list += '<span style="color:green"> inscriptions ouvertes</span>'+
                    '<div id="markerRegistration">'+
                      '<button id="subscribeMarker'+i+'" class="secondColorBg mainColor textBold">S\'inscrire</button>'+
                    '</div>';
                  } else {
                    list += '<span style="color:red> inscriptions fermées</span>';
                  }
                  list +=  '</li>';
                }
                list += '</ul>'
                return list
              };

              var content = '<div id="content">';
                content +=
                '</div>'+
                '<h1 id="markerFirstHeading">' + marker.of.nom + ' <span>(' + marker.sites.adresse.region + ')</span></h1>'+
                '<div id="markerBodyContent">'+
                '<div id="markerRegisterInfos">'+
                getDatesList(marker.sessions)+
                '</div>'+
                '</div>';
              content +=
              '<div id="markerLocationInfos">'+
              '<img src="./icons/trainingIcon.svg" alt="icône bleu de localisation" height="15px" width="15px" top="-5px"/>'+
              '<p id="markerTown">' + marker.sites.adresse.ville + '</p>'+
              // '<div id="markerDetails">' +
              // '<p>' + marker.adresse + '</p>'+
              // '<p> tel : ' + marker.sites.tel + '</p>'+
              // '</div>'+
              '</div>';

              return content
            } else {
              return 'ERROR marker does not exist'
            }
          };

          // create content for marker when clicked
          var infowindow = function (marker) {
            return new google.maps.InfoWindow({
            content: contentString(marker)
            });
          }

          // show popup on marker click.
          var clickedMarker;
          for (let i=0; i < markers.length; i++) {
            var marker = markers[i];
            markers[i].addListener('click', function() {
              if (clickedMarker) {
                clickedMarker.close();
              }
              clickedMarker = infowindow(markerLocations[i]);
              clickedMarker.open(map, markers[i]);

              google.maps.event.addListener(clickedMarker,'domready',function() {
                for (let j = 0; j < markerSaved.sessions.length; j++) {
                  var thisClickedSession = JSON.parse(JSON.stringify(markerSaved));
                  thisClickedSession.sessions = markerSaved.sessions[j];
                  displayRegistration('#subscribeMarker'+j, thisClickedSession);
                }
              });
            });
          }
        })();
        // Add a marker clusterer to manage the markers.
        var markerCluster = new MarkerClusterer(map, markers,
        {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});
      }

      var momentification = function (date) {
        date=date.split('/');
        date=date[2]+'-'+date[1]+'-'+date[0];
        return date
      }

      // Filtering the list of sessions for a search
      function filterData(){
        var dataToFilter = sessionsLocations;

        var selectedFilters=[];  
        fields.map(function(field){
          var fieldSearchValue = $('#'+field.name).val();
          selectedFilters.push({name:field.name, value:fieldSearchValue})
        })
        // console.log(selectedFilters)
        var selectedLocations = dataToFilter.filter(function(location){
          var validLocation=true;
          selectedFilters.map(function(filter){
            //Avoid cases where field is datepicker type / search field value = search field name => means all results
            if(filter.name!=="datepicker" && filter.name!=filter.value && (location.of[filter.name]!==filter.value && location.sites.adresse[filter.name]!==filter.value)){
              validLocation=false;
            }
            else if(filter.name==="datepicker" && filter.value!=="" && location.sessions.periode && location.sessions.periode.debut){
              var date1=filter.value.split(' - ')[0];
              date1 = momentification(date1);
              var date2=filter.value.split(' - ')[1];
              date2 = momentification(date2);
              locationDate = momentification(location.sessions.periode.debut);
              if(moment(locationDate).isBefore(date1) || moment(locationDate).isAfter(date2)){
                validLocation=false;
              }
            }
          })
          return validLocation;
        })
        return selectedLocations;
      }

      // Filtering the list of marker for a search
      function filterMarkers(){
        var dataToFilter = saveMarkerLocations;

        var selectedFilters=[];  
        fields.map(function(field){
          var fieldSearchValue = $('#'+field.name).val();
          selectedFilters.push({name:field.name, value:fieldSearchValue})
        })
        // console.log(selectedFilters)
        var selectedLocations = dataToFilter.filter(function(location){
          var validLocation=true;
          selectedFilters.map(function(filter){
            
            if (filter.name!=="datepicker") {
              if(filter.name!=filter.value && (location.of[filter.name]!==filter.value && location.sites.adresse[filter.name]!==filter.value)){
                validLocation=false;
              }
            }
            
            if(filter.name==="datepicker" && filter.value!==""){
              var testDates = false;
              var date1=filter.value.split(' - ')[0];
              date1 = momentification(date1);
              var date2=filter.value.split(' - ')[1];
              date2 = momentification(date2);
              var locationDate;

              // Check in every dates (j) if there at least one date wich is OK with the search, if not, return false
              for (let j = 0; j < location.sessions.length; j++) {
                locationDate = momentification(location.sessions[j].periode.debut);
                if(moment(locationDate).isAfter(date1) && moment(locationDate).isBefore(date2)){
                  testDates=true;
                }
              }
              if(!testDates){
                validLocation=false;
              }
            }
          })
          return validLocation;
        })
        return selectedLocations;
      }

      function displayResults(selectedLocations){
        if(selectedLocations.length>0){
          // Sort the list by date in ascending order
          selectedLocations.sort(function(a, b) {
            var dateA = a.sessions.periode.debut;
            var dateB = b.sessions.periode.debut;
            dateA = dateA.split("/");
            dateB = dateB.split("/");
            dateA = dateA[1]+"/"+dateA[0]+"/"+dateA[2];
            dateB = dateB[1]+"/"+dateB[0]+"/"+dateB[2];
            dateA = new Date(dateA).getTime();
            dateB = new Date(dateB).getTime();
            return dateA - dateB;
          });

          // Creating month labels
          sessionsByMonthList = [];
          for (var i = 0; i < selectedLocations.length; i++) {
            var date = selectedLocations[i].sessions.periode.debut;
            date = date.split("/");
            var month = date[1];
            var year = date[2];
            if (sessionsByMonthList.length === 0 || month !== sessionsByMonthList[sessionsByMonthList.length - 1].month || year !== sessionsByMonthList[sessionsByMonthList.length - 1].year) {
              sessionsByMonthList.push({month: month, year: year, session: [selectedLocations[i]]});
            } else {
              sessionsByMonthList[sessionsByMonthList.length - 1].session.push(selectedLocations[i]);
            }
          }

          $('#results').html('(' + selectedLocations.length + ')');
          var index = 0;
          sessionsByMonthList.map(function(sessionsInAMonth){
            var monthLabel =
            '<div class="monthBar">'+
              '<h4>'+
                moment().month(sessionsInAMonth.month - 1).format("MMMM").toUpperCase()+' '+sessionsInAMonth.year+
              '</h4>'+
            '</div>';
            $('#results').append(monthLabel)
            for (let i = 0; i < sessionsInAMonth.session.length; i++) {
              var session = sessionsInAMonth.session[i];
              index++;
              id = 'subscribe' + index;
              var openRegistration =
                '<div id="subInfos">'+
                '<img src="./icons/error.svg" alt="croix blanche sur rond rouge" height="25px" width="25px"/>'+
                '<h6 style="color:red"">inscriptions fermées</h6>';
                '</div>';
              // PUT HERE SOME TEST TO CHECK IF REGISTRATION DATE STILL OK /!\
              if (true) {
                openRegistration =
                '<div id="subInfos">'+
                '<img src="./icons/checked.svg" alt="v blanc sur rond vert" height="25px" width="25px"/>'+
                '<h6 style="color:green">inscriptions ouvertes</h6>'+
                '<button id='+id+ ' class="secondColorBg mainColor textBold">S\'inscrire</button>'+
                '</div>';
              }
              var courseReview =
              '<div class="card" >'+
              '<img src="./icons/presentation.svg" alt="icône de personnage faisant une présentation sur un tableau" height="50px" width="50px"/>'+
              '<h6>Session du '+session.sessions.periode.debut+' au '+session.sessions.periode.fin+'</h6>'+
              '<div id="titleAndRegion" >'+
              '<h6>'+session.of.nom+' </h6>'+
              '<p>'+session.sites.adresse.region+'</p>'+
              '</div>'+
              '<div id="markerAndTown" >'+
              '<img src="./icons/trainingIcon.svg" alt="icône bleu de localisation" height="25px" width="25px"/>'+
              '<h6>'+session.sites.adresse.ville+'</h6>'+
              '</div>'+
              openRegistration+
              '</div></div>';
              $('#results').append(courseReview)
              // PUT HERE SOME TEST TO CHECK IF REGISTRATION DATE STILL OK /!\
              if (true) {
                displayRegistration('#' + id, session);
              }
            }
          })
        }
        else{
          $('#results').html('<p>Aucun résultat ne correspond à votre recherche.</p>');
        }
        $('#resultsWrapper').removeClass('hide');
      }

      // ACTIONS
      $("#search").on('click', function(){
        launchSearch();
      });

      // Sending data collected by the user clicking on a session
      var displayRegistration = function (id, registration) {
        $(id).on('click', function(){

          of = registration.of.nom;
          ville = registration.sites.adresse.ville;
          course_id = registration.sessions.course_id;
          enrollment_action = registration.sessions.enrollment_action;
          date_debut = registration.sessions.periode.debut;
          date_fin = registration.sessions.periode.fin;

          console.log(urlForm + '?of=' + of + '&ville=' + ville + '&date_debut=' + date_debut + '&date_fin=' + date_fin);

          // redirect the user to the form
          window.open(urlForm + '?of=' + of + '&course_id=' + course_id + '&enrollment_action=' + enrollment_action + '&ville=' + ville + '&date_debut=' + date_debut + '&date_fin=' + date_fin);
        });
      }

    </script>
    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBZPfRQkb-RFe5AUzHHmW_Q2ojvmIG8-AU&callback=startAPI">
    </script>
  </body>
</html>